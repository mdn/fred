name: Update menu

on:
  workflow_dispatch:

  schedule:
    - cron: "30 4 * * 1-5"

permissions: {} # No GITHUB_TOKEN permissions, because we use MDN_BOT_PAT instead.

jobs:
  update:
    if: github.repository == 'mdn/fred'
    name: Update missing docs
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
        with:
          persist-credentials: false
          ref: main

      - name: Setup Node
        uses: actions/setup-node@6044e13b5dc448c55e2357c09f80417699197238 # v6.2.0
        with:
          node-version-file: .nvmrc
          package-manager-cache: false

      - name: Install
        run: npm ci
        env:
          # Increase GitHub API limit.
          GITHUB_TOKEN: ${{ github.token }}

      - name: Update tabs
        run: node components/menu/update-tabs.js

      - name: Update missing docs
        run: node components/menu/update-missing-docs.js

      - name: Format
        run: npx prettier -w components/menu/*.json

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@c0f553fe549906ede9cf27b5156039d195d2ece0 # v8.1.0
        with:
          token: ${{ secrets.MDN_BOT_PAT }}
          commit-message: "chore(menu): update menu entries"
          author: mdn-bot <108879845+mdn-bot@users.noreply.github.com>
          committer: mdn-bot <108879845+mdn-bot@users.noreply.github.com>
          signoff: false
          branch: update-menu
          delete-branch: true
          add-paths: components/menu/*.json
          title: "chore(menu): update menu entries"
          body: (This PR was generated by [this run](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}) of the [`${{ github.workflow }}`](https://github.com/${{ github.repository }}/blob/${{ github.ref_name }}/.github/workflows/update-menu.yml) workflow.)
          draft: false
